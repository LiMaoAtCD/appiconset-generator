"use strict";const{app:app,BrowserWindow:BrowserWindow,TouchBar:TouchBar,ipcMain:ipcMain}=require("electron"),{TouchBarLabel:TouchBarLabel,TouchBarButton:TouchBarButton,TouchBarSpacer:TouchBarSpacer}=TouchBar,url=require("url"),path=require("path"),fs=require("fs-extra"),sharp=require("electron-sharp"),dialog=require("electron").dialog,Store=require("electron-store"),util=require("util"),loadJSON=require("load-json-file");let win,tempString,touchBar,appIdentifier="com.midwinter-dg."+app.getName().toLowerCase().replace(" ","-"),tempDir=app.getPath("temp")+`${appIdentifier}/`,buttons=[],store=new Store({defaults:{windowBounds:{x:0,y:0},iconType:"macOS",interpolation:"lanczos3",savePath:app.getPath("desktop")}});function createWindow(){let{x:e,y:t,width:n,height:o}=store.get("windowBounds");function i(){store.set("windowBounds",win.getBounds())}(win=new BrowserWindow({show:!1,titleBarStyle:"hiddenInset",x:e,y:t,width:820,height:620,transparent:!0,frame:!1,resizable:!1,maximizable:!1,fullscreen:!1,icon:path.join(__dirname,"../assets/icon/Icon.icns")})).setSheetOffset(32),win.loadURL(url.format({pathname:path.join(__dirname,"../html/app.html"),protocol:"file:",slashes:!0})),win.once("ready-to-show",()=>{win.show(),empty()}),win.on("resize",i),win.on("move",i),win.on("closed",()=>{app.quit(),empty()}),require("./menu-app.min")}function empty(){fs.emptyDir(tempDir,e=>{if(e)return console.error(e)})}function saveIconsetToPath(e){let t=store.get("savePath");dialog.showSaveDialog(win,{defaultPath:t+"/AppIcon.appiconset",buttonLabel:"Save Appiconset"},function(t){t&&fs.copy(e,t,e=>{if(e)return console.error(e);console.info("success!")})})}app.on("ready",createWindow),app.on("open",e=>{dialog.showOpenDialog(win,{defaultPath:app.getPath("home"),buttonLabel:"Choose Image",filters:[{name:"Images",extensions:["png","jpg","gif","bmp"]}],properties:["openFile"],message:"The file must be one of the following types: .png, .jpg, .gif, .bmp"},function(e){e&&win.webContents.send("load",e)})}),ipcMain.on("touchbar",(e,t)=>{for(let e of t)buttons.push(new TouchBarButton({label:e,backgroundColor:"#7F37C5",click:()=>{win.webContents.send("touch",e)}}));buttons.push(new TouchBarSpacer({size:"small"})),buttons.push(new TouchBarButton({label:"Generate Appiconset",backgroundColor:"#3B88FD",click:()=>{win.webContents.send("menu-generate","generate")}})),touchBar=new TouchBar(buttons),win.setTouchBar(touchBar)}),ipcMain.on("size",(e,t)=>{dialog.showMessageBox(win,{type:"info",message:"Image too small",detail:"For best results the image must be at least\n1024 x 1024px",buttons:["OK"]})}),ipcMain.on("valid",(e,t)=>{let n=t.replace(/^data:image\/\w+;base64,/,""),o=Buffer.from(n,"base64");tempString=Date.now(),fs.ensureDir(`${tempDir}/${tempString}/`,e=>{if(e)return console.error(e);fs.writeFile(`${tempDir}/${tempString}.png`,o,function(e){if(e)return console.error(e);win.webContents.send("preview",`${tempDir}/${tempString}.png`)})})}),ipcMain.on("invalid",(e,t)=>{dialog.showMessageBox(win,{type:"error",message:"Invalid file format",detail:`${t} is not a valid image file.\nThe file must be one of the following types: .png, .jpg, .gif, .bmp`,buttons:["OK"]})}),ipcMain.on("generate",(e,t)=>{fs.emptyDirSync(`${tempDir}/${tempString}/`);let n=store.get("interpolation"),o=sharp(`${tempDir}/${tempString}.png`),i={images:[],info:{version:1,author:appIdentifier}};loadJSON(path.join(__dirname,"../json/iconsets.json")).then(e=>{let r=[];for(let a of e[t]){let e=a.size*a.scale,t=`icon_${a.size}x${a.size}@${a.scale}x.png`;!1===r.includes(t)&&(r.push(t),o.resize(e,e,{kernel:sharp.kernel[n],fit:"contain",position:"left top"}).toFile(`${tempDir}/${tempString}/${t}`).then(()=>{console.info(`generated ${a.size} - @${a.scale}x`)}),i.images.push({size:`${a.size}x${a.size}`,idiom:a.idiom,filename:t,scale:`${a.scale}x`}))}fs.writeJson(`${tempDir}/${tempString}/Contents.json`,i,{spaces:"\t"},function(e){if(e)return console.error(e);saveIconsetToPath(`${tempDir}/${tempString}`)})})});
//# sourceMappingURL=maps/main.min.js.map
