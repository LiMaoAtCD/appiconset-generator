{"version":3,"sources":["app.js"],"names":["window","$","jQuery","require","path","app","remote","ipcRenderer","Store","store","loadJSON","mainCanvas","document","getElementById","mainContext","getContext","previewCanvas","previewContext","dropzone","modal","fitImageOn","canvas","context","theImageObj","renderableHeight","renderableWidth","xStart","yStart","imageAspectRatio","width","height","canvasAspectRatio","drawImage","clearCanvas","clearRect","removeClass","empty","loadImage","src","imageObj","Image","size","onload","html","addClass","send","toDataURL","setType","type","prop","focus","hide","show","on","e","stopPropagation","preventDefault","draggedType","originalEvent","dataTransfer","files","includes","event","message","val","set","previewObj","data","click","ready","active","get","join","__dirname","then","json","buttons","count","iconlist","state","push","append","icon","row","scale","this","Number"],"mappings":"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","file":"../app.min.js","sourcesContent":["'use strict'\n\nwindow.$ = window.jQuery = require( 'jquery' )\n\nconst path \t\t\t\t= require( 'path' )\nconst { app } \t\t\t= require( 'electron' ).remote\nconst { ipcRenderer } \t= require( 'electron' )\nconst { remote } \t\t= require( 'electron' )\nconst Store \t\t\t= require( 'electron-store' )\nconst store \t\t\t= new Store()\nconst loadJSON \t\t\t= require( 'load-json-file' )\n\n\nconst \tmainCanvas \t\t= document.getElementById( 'icon' ),\n\t\tmainContext \t= mainCanvas.getContext( '2d' ),\n\t\tpreviewCanvas \t= document.getElementById( 'preview' ),\n\t\tpreviewContext \t= previewCanvas.getContext( '2d' ),\n\t\tdropzone \t\t= $( '#dropzone' )\n\nlet modal\n\n\n\n//note(@duncanmid): based on: fitImageOn by @sdqali\n// https://sdqali.in/blog/2013/10/03/fitting-an-image-in-to-a-canvas-object/\n\nfunction fitImageOn(canvas, context, theImageObj) {\n\t\n\tlet imageAspectRatio = theImageObj.width / theImageObj.height,\n\t\tcanvasAspectRatio = canvas.width / canvas.height,\n\t\trenderableHeight, renderableWidth, xStart, yStart\n\t\n\tif ( theImageObj.width < 1024 && theImageObj.height < 1024 ) {\n\t\n\t\trenderableWidth = theImageObj.width\n\t\trenderableHeight = theImageObj.height\n\t\txStart = (canvas.width - renderableWidth) / 2\n\t\tyStart = (canvas.height - renderableHeight) / 2\n\t\n\t} else if ( imageAspectRatio < canvasAspectRatio ) {\n\t\t\n\t\trenderableHeight = canvas.height\n\t\trenderableWidth = theImageObj.width * (renderableHeight / theImageObj.height)\n\t\txStart = (canvas.width - renderableWidth) / 2\n\t\tyStart = 0\n\t\n\t} else if ( imageAspectRatio > canvasAspectRatio ) {\n\t\t\n\t\trenderableWidth = canvas.width\n\t\trenderableHeight = theImageObj.height * (renderableWidth / theImageObj.width)\n\t\txStart = 0\n\t\tyStart = (canvas.height - renderableHeight) / 2\n\t\n\t} else {\n\t\t\n\t\trenderableHeight = canvas.height\n\t\trenderableWidth = canvas.width\n\t\txStart = 0\n\t\tyStart = 0\n\t}\n\t\n\tcontext.drawImage(theImageObj, xStart, yStart, renderableWidth, renderableHeight)\n}\n\n\n\n//note(@duncanmid): clear canvas\n\nfunction clearCanvas() {\n\t\n\tmainContext.clearRect(0, 0, 1024, 1024)\n\tpreviewContext.clearRect(0, 0, 256, 256)\n\t\n\t$('#size').removeClass().empty()\n\t$('#preview').removeClass('active')\n}\n\n\n//note(@duncanmid): load image to canvas\n\nfunction loadImage( src ) {\n\n\tlet imageObj = new Image(),\n\t\tsize = $('#size')\n\t\n\timageObj.src = src\n\t\n\timageObj.onload = function() {\n\t\t\n\t\tfitImageOn( mainCanvas, mainContext, imageObj )\n\t\t\n\t\tsize.html(`original size: ${imageObj.width} Ã— ${imageObj.height}px`)\n\t\t\n\t\tif( imageObj.width + imageObj.height < 2048 ) {\n\t\t\t\n\t\t\tsize.addClass('alert')\n\t\t\t\n\t\t\tipcRenderer.send('size', 'size')\n\t\t}\n\t\t\n\t\tipcRenderer.send('valid', $('#icon')[0].toDataURL())\n\t}\n}\n\n\n\n//note(@duncanmid): set radio button type\n\nfunction setType( type ) {\n\t\n\t$('input[name=\"type\"][value=\"' + type + '\"]').prop('checked', true).focus()\n\t$('.form table').hide()\n\t$(`table.icon-${type}`).show('fast')\n}\n\n\n\n//note(@duncanmid): drag and drop image\n\ndropzone.on('dragover', function() {\n\t\n\tdropzone.addClass( 'hover' )\n\treturn false\n})\n\n\n\ndropzone.on('dragleave', function() {\n\t\n\tdropzone.removeClass( 'hover' )\n\treturn false\n})\n\n\n\ndropzone.on('drop', function(e) {\n\t\n\te.stopPropagation()\n\te.preventDefault()\n\t\n\tdropzone.removeClass( 'hover' )\n\t\n\tconst \timgTypes = ['image/png', 'image/jpg', 'image/jpeg', 'image/gif', 'image/bmp'],\n\t\t\tdraggedType = e.originalEvent.dataTransfer.files[0].type\n\t\n\tif (imgTypes.includes(draggedType)) {\n\t\t\n\t\tclearCanvas()\n\t\tloadImage( e.originalEvent.dataTransfer.files[0]['path'] )\n\t\t\n\t} else {\n\t\t\n\t\tipcRenderer.send('invalid', e.originalEvent.dataTransfer.files[0]['name'] )\n\t}\n\t\t\n\treturn false\n})\n\n\n//note(@duncanmid): action on touch\n\nipcRenderer.on('touchButton', (event, message) => {\n\t\n\tif( $('input[name=\"type\"]:checked').val() !== message ) {\n\t\n\t\tsetType( message )\n\t\t\n\t\tstore.set( 'iconType', message )\n\t}\n})\n\n\n\nipcRenderer.on('touchbar-select', (event, message) => {\n\t\n\tsetType( message )\n\tstore.set( 'iconType', message )\n})\n\n\n\nipcRenderer.on('delete', (event, message) => {\n\t\n\tclearCanvas()\n\t$('#generate').prop('disabled', true)\n\t\n\tipcRenderer.send('deleted', 'deleted' )\n})\n\n\n\nipcRenderer.on('load', (event, message) => {\n\t\n\t$('#generate').prop('disabled', false)\n\tloadImage( message )\n})\n\n\n\nipcRenderer.on('preview', (event, message) => {\n\t\n\tlet previewObj = new Image()\n\t\n\tpreviewObj.src = message\n\t\n\tpreviewObj.onload = function() {\n\t\t\n\t\tfitImageOn( previewCanvas, previewContext, previewObj )\n\t\t\n\t\t$('#preview').addClass('active')\n\t\t$('#generate').prop('disabled', false)\n\t}\n})\n\n\n\n//note(@duncanmid): generate .iconset\n\nipcRenderer.on('menu-generate', (event, message) => {\n\t\n\tif( !$('#generate').prop('disabled') ) {\n\t\n\t\tipcRenderer.send('generate', $('input[name=\"type\"]:checked').data( 'name' ) )\n\t}\n})\n\n\n\n$('#generate').click( function() { \n\t\n\tipcRenderer.send('generate', $('input[name=\"type\"]:checked').data( 'name' ) )\n})\n\n\n\n//note(@duncanmid): modal\n\n/* function openModal( url, width, height, resize ) {\n\t\n\tmodal = new remote.BrowserWindow({\n\t\t\n\t\t\tparent: remote.getCurrentWindow(),\n\t\t\tmodal: true,\n\t\t\twidth: width,\n\t\t\tminWidth: width,\n\t\t\tmaxWidth: width,\n\t\t\theight: height,\n\t\t\tminHeight: height,\n\t\t\tresizable: resize,\n\t\t\tshow: false,\n\t\t\tbackgroundColor: '#031320'\n\t\t})\n\t\t\n\tmodal.loadURL( url )\n\t\n\tmodal.once('ready-to-show', () => {\n\t\t\n\t\tmodal.show()\n\t})\n} */\n\n\n\n//note(@duncanmid): docready\n\n$( document ).ready( function() {\n\t\n\tlet active = store.get( 'iconType' )\n\t\n\tloadJSON( path.join(__dirname, '../json/iconsets.json') ).then(json => {\n\t\t\n\t\tlet buttons \t= [],\n\t\t\tcount \t= 0\n\t\t\n\t\tfor ( let type in json ) {\n\t\t\t\n\t\t\tlet iconlist = [],\n\t\t\t\tstate = (count == active) ? true : false;\n\t\t\t\n\t\t\t//todo(@duncanmid): send as object with state\n\t\t\t//buttons.push( type )\n\t\t\t\n\t\t\tbuttons.push({\n\t\t\t\t\n\t\t\t\t'type': type,\n\t\t\t\t'state': state\n\t\t\t})\n\t\t\t\n\t\t\t$('.form').append( `<label><input type=\"radio\" name=\"type\" value=\"${count}\" data-name=\"${type}\" /> ${type}<table class=\"icon-${count}\"></table></label>` )\n\t\t\t\n\t\t\tfor ( let icon of json[type] ) {\n\t\t\t\t\n\t\t\t\tlet row = `<tr><td>${icon.size}x${icon.size}px</td><td>@${icon.scale}x</td></tr>`\n\t\t\t\t\n\t\t\t\tif ( iconlist.includes( row ) === false ) {\n\t\t\t\t\t\n\t\t\t\t\ticonlist.push( row )\n\t\t\t\t\t$( `table.icon-${count}` ).append( row )\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tcount++\n\t\t}\n\t\t\n\t\tsetType( active )\n\t\t\n\t\tipcRenderer.send( 'touchbar', buttons )\n\t})\n\t\n\t\n\t$('body').on('click', 'input[name=\"type\"]', function() {\n\t\t\n\t\t$( '.form table' ).hide()\n\t\t$( `.icon-${$(this).val()}` ).show( 'fast' )\n\t\t\n\t\tipcRenderer.send('touchbar-index',  Number( $(this).val() ) )\n\t\tstore.set( 'iconType', Number( $(this).val() ) )\n\t})\n})\n"]}